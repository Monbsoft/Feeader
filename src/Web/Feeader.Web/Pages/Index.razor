@page "/"
@implements IDisposable
@inject FeedService FeedService
@inject ILogger<Index> Logger

<PageTitle>News</PageTitle>
@if(_articles == null)
{
    <Loading/>
}
else 
{
    <MudGrid>
        <MudItem xs="2">
            <NavMenu/>
        </MudItem>
        <MudItem xs="10">
            <MudText Typo="Typo.h3">News</MudText>
            <ArticleList Articles="@_articles"/>
        </MudItem>
    </MudGrid>

}

@code {
    private CancellationTokenSource _cts = new();
    private List<Article>? _articles;

    [Parameter]
    public Guid Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var articles = await FeedService.ListArticlesAsync(100, _cts.Token);
        _articles = articles.ToList();
        Logger.LogInformation($"{_articles.Count} articles found");
    }

    public void Dispose()
    {
        _cts.Cancel();
        _cts.Dispose();
    }
}

