@page "/feeds"
@implements IDisposable
@inject FeedService FeedService
@inject ILogger<Feeds> Logger

<MudGrid>
    <MudItem xs="8">
        <MudText Typo="Typo.h3">Feeds</MudText>
    </MudItem>
    <MudItem xs="4">
        <MudButton Class="d-flex align-center justify-center" Variant="Variant.Outlined" Href="/feeds/create">Create</MudButton>
    </MudItem>
</MudGrid>

@if(_feeds == null)
{
    <Loading/>
}
else
{
    <MudList Clickable="true">
        @foreach(var feed in _feeds)
        {
            <MudListItem Avatar="@Icons.Filled.Feed" Text="@feed.Name"/>
        }
    </MudList>
}

@code {
    private Feed[]? _feeds;
    private CancellationTokenSource cts = new();

    protected override async Task OnInitializedAsync()
    {
        _feeds = await FeedService.ListAsync(cts.Token);
        Logger.LogInformation("{Count} feeds listed", _feeds?.Length);
    }

    public void Dispose()
    {
        cts.Cancel();
        cts.Dispose();
    }
}
