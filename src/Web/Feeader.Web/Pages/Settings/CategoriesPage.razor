@page "/settings/categories"
@implements IDisposable
@inject FeedService FeedService
@inject ILogger<CategoriesPage> Logger

@if (_categories == null)
{
    <Loading />
}
else
{
    <SettingList Title="Categories">
        <ActionContent>
            <MudButton Variant="Variant.Outlined" Href="/categories/create">Create</MudButton>
        </ActionContent>
        <ChildContent>
        @foreach (var category in _categories)
        {
            <MudCard>
                <MudCardContent>
                    <MudText Typo="Typo.h5">@category.Genre</MudText>
                    <MudText Typo="Typo.body2">@category.Updated.Humanize()</MudText>
                </MudCardContent>
            </MudCard>
        }
        </ChildContent>
    </SettingList>
}

@code {
    private CancellationTokenSource _cts = new();
    private Category[] _categories;

    protected override async Task OnInitializedAsync()
    {
        _categories = await FeedService.ListCategoriesAsync(_cts.Token);
        Logger.LogInformation("{Count} categories listed", _categories?.Length);
    }

    public void Dispose()
    {
        _cts.Cancel();
        _cts.Dispose();
    }
}
